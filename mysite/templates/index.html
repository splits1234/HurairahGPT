<!--
  Copyright (c) 2025 Hurairah
  All Rights Reserved. Proprietary Software.
  Legal matters handled by parent/guardian until age 18.
  Governed by Pakistan law (Rawalpindi jurisdiction).
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HurairahGPT â€“ Chat with AI</title>
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
<meta name="description" content="Talk to HurairahGPT, your AI assistant. Chat, get answers, and enjoy a smart conversational experience.">
<meta property="og:title" content="HurairahGPT â€“ Chat with AI">
<meta property="og:description" content="Talk to HurairahGPT, your AI assistant. Chat, get answers, and enjoy a smart conversational experience.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.talktohurairah.com">
<meta property="og:image" content="{{ url_for('static', filename='logo.png') }}">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="HurairahGPT â€“ Chat with AI">
<meta name="twitter:description" content="Talk to HurairahGPT, your AI assistant. Chat, get answers, and enjoy a smart conversational experience.">
<meta name="twitter:image" content="{{ url_for('static', filename='logo.png') }}">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.4/dist/purify.min.js"></script>

<style>
:root {
  --bg-light: #f6f7fb; --bg-dark: #050816;
  --card-light: rgba(255,255,255,0.9); --card-dark: rgba(11,17,30,0.95);
  --text-light: #111827; --text-dark: #e5e7eb;
  --muted-light: #6b7280; --muted-dark: #9ca3af;
  --accent: #6366f1; --accent-soft: rgba(99,102,241,0.14);
  --accent-strong: #4f46e5; --accent-secondary: #f97316;
  --danger: #ef4444;
  --chat-user: linear-gradient(135deg,#6366f1,#ec4899);
  --chat-bot-light: #f9fafb; --chat-bot-dark: #020617;
}

*{margin:0;padding:0;box-sizing:border-box;}
html, body{height:100%;font-family:'Inter',sans-serif;display:flex;align-items:center;justify-content:center;overflow:hidden;}
body{background:radial-gradient(circle at 0% 0%,#38bdf8 0,transparent 45%),radial-gradient(circle at 100% 100%,#a855f7 0,transparent 55%),radial-gradient(circle at 0% 100%,#f97316 0,transparent 55%),var(--bg-dark);color:var(--text-dark);padding:24px;}
body.light{background:radial-gradient(circle at 0% 0%,rgba(56,189,248,0.2)0,transparent 45%),radial-gradient(circle at 100% 100%,rgba(168,85,247,0.2)0,transparent 55%),radial-gradient(circle at 0% 100%,rgba(249,115,22,0.18)0,transparent 55%),var(--bg-light);color:var(--text-light);}

.aurora{position:fixed;inset:-40%;background:conic-gradient(from 180deg,rgba(56,189,248,0.4),rgba(168,85,247,0.4),rgba(34,197,94,0.4),rgba(248,250,252,0.2),rgba(249,115,22,0.4),rgba(56,189,248,0.4));opacity:0.18;filter:blur(52px);mix-blend-mode:screen;pointer-events:none;z-index:-1;animation:auroraShift 26s linear infinite alternate;}
@keyframes auroraShift{0%{transform:translate3d(-10px,-40px,0) rotate(-2deg) scale(1.05);}100%{transform:translate3d(30px,40px,0) rotate(4deg) scale(1.12);}}

.shell{position:relative;display:flex;gap:16px;width:100%;max-width:1080px;height:clamp(640px,90vh,780px);border-radius:24px;padding:18px;background:rgba(15,23,42,0.72);border:1px solid rgba(148,163,184,0.2);box-shadow:0 40px 80px rgba(15,23,42,0.8);backdrop-filter:blur(26px) saturate(160%);overflow:hidden;}
body.light .shell{background:rgba(255,255,255,0.88);border-color:rgba(148,163,184,0.38);box-shadow:0 32px 65px rgba(15,23,42,0.18);}

.sidebar{width:260px;min-width:220px;max-width:280px;border-radius:18px;padding:18px 18px 16px;background:radial-gradient(circle at 0 0, rgba(129,140,248,0.22),transparent 55%),radial-gradient(circle at 100% 100%,rgba(236,72,153,0.18),transparent 55%),rgba(15,23,42,0.92);border:1px solid rgba(148,163,184,0.35);display:flex;flex-direction:column;gap:14px;}
body.light .sidebar{background:radial-gradient(circle at 0 0, rgba(129,140,248,0.12),transparent 55%),rgba(249,250,251,0.98);border-color:rgba(148,163,184,0.6);}

.sidebar-header{display:flex;align-items:center;gap:10px;margin-bottom:2px;}
.logo{width:32px;height:32px;border-radius:999px;background:conic-gradient(from 140deg,#6366f1,#ec4899,#f97316,#22c55e,#6366f1);display:flex;align-items:center;justify-content:center;color:#fff;font-size:0.9rem;font-weight:700;box-shadow:0 0 0 1px rgba(15,23,42,0.5),0 10px 22px rgba(15,23,42,0.8);}
body.light .logo{box-shadow:0 0 0 1px rgba(248,250,252,0.9),0 12px 24px rgba(15,23,42,0.22);}
.brand{display:flex;flex-direction:column;gap:2px;}
.brand-title{font-size:0.95rem;font-weight:600;letter-spacing:0.03em;}
.brand-sub{font-size:0.75rem;color:var(--muted-dark);}
body.light .brand-sub{color:var(--muted-light);}

.sidebar-section{border-radius:14px;padding:10px;background:rgba(15,23,42,0.65);border:1px solid rgba(30,64,175,0.7);}
body.light .sidebar-section{background:rgba(249,250,251,0.92);border-color:rgba(148,163,184,0.7);}
.sidebar-label{font-size:0.72rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted-dark);margin-bottom:6px;}
body.light .sidebar-label{color:var(--muted-light);}

.sessions-list{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto;}
.sessions-list::-webkit-scrollbar{width:4px;}
.sessions-list::-webkit-scrollbar-thumb{background:rgba(99,102,241,0.5);border-radius:2px;}

.session-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;background:rgba(15,23,42,0.6);border:1px solid rgba(148,163,184,0.3);cursor:pointer;transition:all 0.2s ease;font-size:0.8rem;position:relative;}
body.light .session-item{background:rgba(243,244,246,0.8);border-color:rgba(148,163,184,0.5);}
.session-item:hover{background:rgba(30,64,175,0.4);border-color:rgba(99,102,241,0.6);transform:translateX(2px);}
body.light .session-item:hover{background:rgba(219,234,254,0.6);border-color:rgba(99,102,241,0.5);}
.session-item.active{background:rgba(99,102,241,0.25);border-color:var(--accent);box-shadow:0 0 0 1px rgba(99,102,241,0.4);}
body.light .session-item.active{background:rgba(219,234,254,0.8);}
.session-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--text-dark);}
body.light .session-name{color:var(--text-light);}
.session-actions{display:flex;gap:4px;opacity:0;transition:opacity 0.2s;}
.session-item:hover .session-actions{opacity:1;}
.session-btn{width:20px;height:20px;border-radius:4px;border:none;background:rgba(99,102,241,0.2);color:var(--accent);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.7rem;transition:all 0.15s;}
.session-btn:hover{background:rgba(99,102,241,0.4);transform:scale(1.1);}
.session-btn.delete{background:rgba(239,68,68,0.2);color:var(--danger);}
.session-btn.delete:hover{background:rgba(239,68,68,0.4);}

.btn-new-session{width:100%;padding:8px 12px;border-radius:10px;border:1px dashed rgba(148,163,184,0.5);background:rgba(15,23,42,0.4);color:var(--text-dark);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;font-size:0.8rem;font-weight:500;transition:all 0.2s ease;}
body.light .btn-new-session{background:rgba(243,244,246,0.6);color:var(--text-light);border-color:rgba(148,163,184,0.6);}
.btn-new-session:hover{background:rgba(99,102,241,0.2);border-color:var(--accent);transform:translateY(-1px);}
body.light .btn-new-session:hover{background:rgba(219,234,254,0.6);}

.sidebar-footer{margin-top:auto;display:flex;flex-direction:column;gap:8px;font-size:0.78rem;color:var(--muted-dark);}
body.light .sidebar-footer{color:var(--muted-light);}
.sidebar-footer strong{font-weight:600;color:inherit;}

.main{flex:1;border-radius:18px;padding:16px 16px 14px;background:radial-gradient(circle at 0 0,rgba(15,23,42,0.92),rgba(15,23,42,0.96)),linear-gradient(to bottom right,#020617,#020617);border:1px solid rgba(30,64,175,0.7);display:flex;flex-direction:column;gap:10px;}
body.light .main{background:radial-gradient(circle at 0 0,rgba(249,250,251,0.98),rgba(248,250,252,0.98)),linear-gradient(to bottom right,#e5e7eb,#f9fafb);border-color:rgba(148,163,184,0.7);}

.top-bar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.top-left{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-size:0.78rem;background:rgba(15,23,42,0.92);border:1px solid rgba(51,65,85,0.9);color:#e5e7eb;}
body.light .pill{background:rgba(255,255,255,0.9);border-color:rgba(148,163,184,0.9);color:#111827;}
.status-dot{width:8px;height:8px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 3px rgba(34,197,94,0.25);}
.top-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-end;}
button{border:none;cursor:pointer;font-family:inherit;font-size:0.85rem;font-weight:500;border-radius:999px;padding:8px 13px;display:inline-flex;align-items:center;gap:6px;color:#e5e7eb;background:rgba(30,64,175,0.95);box-shadow:0 10px 25px rgba(30,64,175,0.45);position:relative;overflow:hidden;transition:transform 0.12s,box-shadow 0.12s,background 0.12s,color 0.12s;}
button span.icon{font-size:1rem;}
button:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 0 0,rgba(248,250,252,0.3),transparent 55%);opacity:0;pointer-events:none;transition:opacity 0.16s;}
button:hover{transform:translateY(-1px);box-shadow:0 16px 35px rgba(30,64,175,0.5);}
button:hover:before{opacity:1;}
button:active{transform:translateY(0) scale(0.98);box-shadow:0 6px 16px rgba(15,23,42,0.7);}
.btn-ghost{background:transparent;border:1px solid rgba(148,163,184,0.8);color:#e5e7eb;box-shadow:none;}
body.light .btn-ghost{background:rgba(255,255,255,0.85);color:#111827;box-shadow:0 4px 10px rgba(15,23,42,0.1);}
.btn-ghost:before{display:none;}
.btn-accent{background:linear-gradient(135deg,#6366f1,#ec4899);box-shadow:0 18px 40px rgba(76,29,149,0.8);}
.btn-danger{background:rgba(239,68,68,0.1);color:#fca5a5;border:1px solid rgba(239,68,68,0.6);box-shadow:none;}
body.light .btn-danger{color:#b91c1c;background:rgba(254,226,226,0.9);border-color:rgba(248,113,113,0.6);}

.profile{display:inline-flex;align-items:center;gap:8px;padding:4px 10px;border-radius:999px;background:rgba(15,23,42,0.92);border:1px solid rgba(148,163,184,0.8);color:#e5e7eb;font-size:0.78rem;}
body.light .profile{background:rgba(255,255,255,0.92);color:#111827;border-color:rgba(148,163,184,0.8);}
.avatar{width:20px;height:20px;border-radius:999px;background:linear-gradient(135deg,#0ea5e9,#6366f1);display:inline-flex;align-items:center;justify-content:center;font-size:0.7rem;color:white;font-weight:600;}

.chat-box{flex:1;border-radius:14px;padding:14px 14px 10px;background:radial-gradient(circle at 0 0,rgba(15,23,42,0.8),rgba(15,23,42,0.98));border:1px solid rgba(31,41,55,0.9);display:flex;flex-direction:column;gap:10px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(148,163,184,0.9) transparent;}
body.light .chat-box{background:linear-gradient(180deg,#f3f4f6,#e5e7eb);border-color:rgba(148,163,184,0.8);}
.chat-box::-webkit-scrollbar{width:8px;}
.chat-box::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#6366f1,#ec4899);border-radius:999px;}
.message{max-width:78%;padding:10px 13px;border-radius:14px;font-size:0.95rem;line-height:1.5;white-space:pre-wrap;position:relative;animation:fadeInMessage 0.22s ease-out;box-shadow:0 10px 26px rgba(15,23,42,0.65);}
.message.user{align-self:flex-end;background:var(--chat-user);color:#f9fafb;border-bottom-right-radius:4px;}
.message.bot{align-self:flex-start;background:radial-gradient(circle at 0 0,rgba(24,37,78,0.96),rgba(15,23,42,0.96));color:#e5e7eb;border-bottom-left-radius:4px;}
body.light .message.bot{background:var(--chat-bot-light);color:#111827;}
@keyframes fadeInMessage{0%{opacity:0;transform:translateY(12px);}100%{opacity:1;transform:translateY(0);}}

.typing{font-style:italic;color:var(--muted-dark);}
body.light .typing{color:var(--muted-light);}

.chat-input{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:12px;background:rgba(15,23,42,0.85);border:1px solid rgba(99,102,241,0.5);}
body.light .chat-input{background:rgba(255,255,255,0.92);border-color:rgba(99,102,241,0.3);}
.chat-input textarea{flex:1;border:none;background:transparent;color:inherit;font-family:inherit;font-size:0.95rem;resize:none;outline:none;height:38px;padding:6px 4px;overflow-y:auto;}
.chat-input button{flex-shrink:0;}
</style>
</head>
<body>
<div class="aurora"></div>

<div class="shell">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">H</div>
      <div class="brand">
        <div class="brand-title">HurairahGPT</div>
        <div class="brand-sub">AI Assistant</div>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">Sessions</div>
      <div class="sessions-list" id="sessionsList"></div>
      <button class="btn-new-session" id="newSessionBtn">+ New Session</button>
    </div>

    <div class="sidebar-footer">
      <div>Made by <strong>Hurairah</strong></div>
      <div>Â© 2025 All Rights Reserved</div>
    </div>
  </aside>

  <main class="main">
    <div class="top-bar">
      <div class="top-left">
        <span class="pill"><span class="status-dot"></span> Online</span>
      </div>
      <div class="top-right">
        <button id="toggleDarkBtn">ðŸŒ™ Dark Mode</button>
        <button id="installBtn" class="btn-ghost">Install PWA</button>
      </div>
    </div>

    <div class="chat-box" id="chatBox" aria-live="polite"></div>

    <form class="chat-input" id="chatForm">
      <textarea id="messageInput" placeholder="Type a message..."></textarea>
      <button type="submit">Send</button>
    </form>
  </main>
</div>

<audio id="sendSound" src="{{ url_for('static', filename='send.mp3') }}"></audio>
<audio id="receiveSound" src="{{ url_for('static', filename='receive.mp3') }}"></audio>

<script>
let sessions = [];
let currentSession = null;
let deferredPrompt = null;

const chatBox = document.getElementById('chatBox');
const messageInput = document.getElementById('messageInput');
const chatForm = document.getElementById('chatForm');
const sessionsList = document.getElementById('sessionsList');
const newSessionBtn = document.getElementById('newSessionBtn');
const toggleDarkBtn = document.getElementById('toggleDarkBtn');
const installBtn = document.getElementById('installBtn');
const sendSound = document.getElementById('sendSound');
const receiveSound = document.getElementById('receiveSound');

function saveSessions() {
  localStorage.setItem('hurairahgptSessions', JSON.stringify(sessions));
  localStorage.setItem('hurairahgptTheme', document.body.classList.contains('light') ? 'light' : 'dark');
}

function loadSessions() {
  const data = JSON.parse(localStorage.getItem('hurairahgptSessions') || '[]');
  sessions = data.length ? data : [{id:Date.now(), name:'Session 1', messages:[]}];
  currentSession = sessions[0];
}

function renderSessions() {
  sessionsList.innerHTML = '';
  sessions.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'session-item' + (s.id === currentSession.id ? ' active' : '');
    div.innerHTML = `<span class="session-name">${s.name}</span>
      <div class="session-actions">
        <button class="session-btn delete">Ã—</button>
      </div>`;
    div.onclick = () => { currentSession = s; renderSessions(); renderMessages(); };
    div.querySelector('.delete').onclick = (e) => {
      e.stopPropagation();
      sessions.splice(i,1);
      if(!sessions.length) sessions.push({id:Date.now(),name:'Session 1',messages:[]});
      currentSession = sessions[0];
      renderSessions();
      renderMessages();
      saveSessions();
    };
    sessionsList.appendChild(div);
  });
}

function appendMessage(role, text) {
  const msg = document.createElement('div');
  msg.className = 'message ' + role;
  msg.innerHTML = DOMPurify.sanitize(marked.parse(text));
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function renderMessages() {
  chatBox.innerHTML = '';
  currentSession.messages.forEach(m => appendMessage(m.role, m.text));
}

function newSession() {
  const session = {id:Date.now(), name:'Session ' + (sessions.length+1), messages:[]};
  sessions.push(session);
  currentSession = session;
  renderSessions();
  renderMessages();
  saveSessions();
}

chatForm.addEventListener('submit', async e => {
  e.preventDefault();
  const text = messageInput.value.trim();
  if(!text) return;
  currentSession.messages.push({role:'user', text});
  appendMessage('user', text);
  messageInput.value = '';
  sendSound.play();
  chatBox.scrollTop = chatBox.scrollHeight;

  appendMessage('bot', 'Typing...');
  chatBox.scrollTop = chatBox.scrollHeight;

  // Simulate AI response â€“ replace with your API call
  const response = await new Promise(r => setTimeout(()=>r("Hello! This is HurairahGPT responding."),800));
  currentSession.messages.pop();
  appendMessage('bot', response);
  receiveSound.play();
  saveSessions();
});

newSessionBtn.onclick = newSession;

toggleDarkBtn.onclick = () => {
  document.body.classList.toggle('light');
  saveSessions();
};

window.addEventListener('DOMContentLoaded', () => {
  const theme = localStorage.getItem('hurairahgptTheme');
  if(theme==='light') document.body.classList.add('light');
  loadSessions();
  renderSessions();
  renderMessages();
});

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-flex';
});

installBtn.onclick = async () => {
  if(deferredPrompt){
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    console.log('PWA install choice', choice.outcome);
    deferredPrompt = null;
  }
};
</script>
</body>
</html>
